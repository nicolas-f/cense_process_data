import time
import h5py
import argparse
import remfile
import urllib3
import multiprocessing

def fetch_hdf5_files(api_url):
    sensors = []
    # fetch hdf5 file list for project
    resp = urllib3.request("GET", api_url)
    data = resp.json()["data"]["items"]
    document: dict
    for document in data:
        if document.get("file_content_type", "") == "application/x-hdf":
            sensors.append(document)
    return sensors


def fetch_sensors_per_day(documents):
    day_occurrences = {'2019_04_16': 19, '2019_05_06': 9, '2019_06_18': 15, '2019_09_11': 18, '2019_09_12': 19, '2019_09_13': 19, '2019_09_14': 20, '2019_09_15': 18, '2019_09_16': 19, '2019_09_17': 19, '2019_09_18': 19, '2019_09_19': 19, '2019_09_20': 19, '2019_09_21': 19, '2019_09_22': 9, '2019_09_23': 9, '2019_09_24': 9, '2019_09_25': 9, '2019_09_26': 10, '2019_09_27': 10, '2019_09_28': 9, '2019_09_29': 9, '2019_09_30': 9, '2019_10_01': 9, '2019_10_02': 9, '2019_10_03': 9, '2019_10_04': 10, '2019_10_05': 9, '2019_10_06': 9, '2019_10_07': 10, '2019_10_08': 10, '2019_10_09': 10, '2019_10_28': 20, '2019_10_29': 20, '2019_12_06': 32, '2019_12_07': 32, '2019_12_08': 32, '2019_12_09': 35, '2019_12_10': 37, '2019_12_11': 38, '2019_12_14': 36, '2019_12_20': 36, '2019_12_21': 31, '2019_12_22': 31, '2019_12_23': 31, '2019_12_24': 31, '2019_12_25': 30, '2019_12_26': 31, '2019_12_27': 31, '2019_12_28': 31, '2019_12_29': 31, '2019_12_30': 31, '2019_12_31': 31, '2020_01_01': 30, '2020_01_02': 30, '2020_01_03': 30, '2020_01_04': 30, '2020_01_08': 35, '2020_01_09': 35, '2020_01_10': 35, '2020_01_11': 35, '2020_01_12': 35, '2020_01_13': 35, '2020_01_14': 35, '2020_01_15': 35, '2020_01_16': 35, '2020_01_17': 35, '2020_01_18': 35, '2020_01_19': 35, '2020_01_20': 35, '2020_01_21': 36, '2020_01_22': 36, '2020_01_23': 32, '2020_01_24': 35, '2020_01_25': 35, '2020_01_26': 35, '2020_01_27': 36, '2020_01_28': 35, '2020_01_29': 35, '2020_01_30': 36, '2020_01_31': 35, '2020_02_01': 35, '2020_02_02': 35, '2020_02_03': 35, '2020_02_04': 35, '2020_02_05': 36, '2020_02_06': 36, '2020_02_07': 34, '2020_02_08': 34, '2020_02_09': 34, '2020_02_10': 32, '2020_02_11': 33, '2020_02_12': 32, '2020_02_13': 33, '2020_02_14': 33, '2020_02_15': 33, '2020_02_16': 33, '2020_02_17': 34, '2020_02_18': 33, '2019_04_19': 24, '2019_05_21': 6, '2019_06_17': 12, '2019_08_17': 11, '2019_12_12': 36, '2019_12_13': 36, '2019_12_15': 34, '2019_12_16': 35, '2019_12_17': 34, '2019_12_18': 34, '2019_12_19': 34, '2020_02_19': 32, '2020_02_20': 32, '2020_02_21': 24, '2020_02_22': 32, '2020_02_23': 32, '2020_02_24': 34, '2020_02_25': 34, '2020_02_26': 34, '2020_02_27': 32, '2020_02_28': 34, '2020_02_29': 33, '2020_03_01': 34, '2020_03_02': 33, '2020_03_03': 34, '2020_03_04': 34, '2020_03_05': 34, '2020_03_06': 33, '2020_03_07': 32, '2020_03_08': 32, '2020_03_09': 30, '2020_03_10': 30, '2020_03_11': 31, '2020_03_12': 31, '2020_03_13': 31, '2020_03_14': 31, '2020_03_15': 31, '2020_03_16': 31, '2020_03_17': 32, '2020_03_18': 32, '2020_03_19': 32, '2020_03_20': 32, '2020_03_21': 31, '2020_03_22': 31, '2020_03_23': 31, '2020_03_24': 32, '2020_03_25': 31, '2020_03_26': 31, '2020_03_27': 31, '2020_03_28': 31, '2020_03_29': 30, '2020_03_30': 30, '2020_03_31': 30, '2020_04_01': 30, '2020_04_02': 31, '2020_04_03': 31, '2020_04_04': 31, '2020_04_05': 31, '2020_04_06': 31, '2020_04_07': 31, '2020_04_08': 31, '2020_04_09': 31, '2020_04_10': 31, '2020_04_11': 31, '2020_04_12': 31, '2020_04_13': 31, '2020_04_14': 31, '2020_04_15': 31, '2020_04_16': 31, '2020_04_17': 31, '2020_04_18': 31, '2020_04_19': 31, '2020_04_20': 31, '2020_04_21': 31, '2019_04_15': 16, '2020_04_22': 30, '2020_04_23': 30, '2020_04_24': 30, '2020_04_25': 30, '2020_04_26': 30, '2020_04_27': 30, '2020_04_28': 30, '2020_04_29': 30, '2020_04_30': 30, '2020_05_01': 30, '2020_05_02': 30, '2020_05_03': 30, '2020_05_04': 30, '2020_05_05': 30, '2020_05_06': 30, '2020_05_07': 30, '2020_05_08': 30, '2020_05_09': 30, '2020_05_10': 30, '2020_05_11': 30, '2020_05_12': 31, '2020_05_13': 29, '2020_05_14': 29, '2020_05_15': 29, '2020_05_16': 29, '2020_05_17': 29, '2020_05_18': 29, '2020_05_19': 29, '2020_05_20': 29, '2020_05_21': 29, '2020_05_22': 29, '2020_05_23': 29, '2020_05_24': 29, '2020_05_25': 29, '2020_05_26': 29, '2020_05_27': 29, '2020_05_28': 29, '2020_05_29': 25, '2020_05_30': 25, '2020_05_31': 25, '2020_06_01': 25, '2020_06_02': 25, '2020_06_03': 25, '2020_06_04': 25, '2020_06_05': 24, '2020_06_06': 24, '2020_06_07': 24, '2020_06_08': 24, '2020_06_09': 24, '2020_06_10': 25, '2020_06_11': 24, '2020_06_12': 24, '2020_06_13': 24, '2020_06_14': 24, '2020_06_15': 24, '2020_06_16': 24, '2020_06_17': 24, '2020_06_18': 24, '2020_06_19': 24, '2020_06_20': 24, '2020_06_21': 24, '2020_06_22': 24, '2020_06_23': 24, '2020_06_24': 24, '2020_06_25': 24, '2020_06_26': 24, '2020_06_27': 24, '2020_06_28': 24, '2020_06_29': 24, '2020_06_30': 24, '2020_07_01': 24, '2020_07_02': 24, '2020_07_03': 24, '2020_07_04': 24, '2020_07_05': 24, '2020_07_06': 24, '2020_07_07': 24, '2020_07_08': 24, '2020_07_09': 21, '2020_07_10': 21, '2020_07_11': 21, '2020_07_12': 21, '2020_07_13': 21, '2020_07_14': 21, '2020_07_15': 21, '2020_07_16': 21, '2020_07_17': 23, '2020_07_18': 23, '2020_07_19': 23, '2020_07_20': 23, '2020_07_21': 24, '2020_07_22': 22, '2020_07_23': 23, '2020_07_24': 22, '2020_07_25': 21, '2020_07_26': 21, '2020_07_27': 22, '2020_07_28': 22, '2020_07_29': 22, '2020_07_30': 22, '2020_07_31': 22, '2020_08_01': 22, '2020_08_02': 22, '2020_08_03': 22, '2020_08_04': 22, '2020_08_05': 22, '2020_08_06': 22, '2020_08_07': 22, '2020_08_08': 22, '2020_08_09': 22, '2020_08_10': 21, '2020_08_11': 22, '2020_08_12': 22, '2020_08_13': 23, '2020_08_14': 23, '2020_08_15': 23, '2020_08_16': 23, '2020_08_17': 23, '2020_08_18': 23, '2020_08_19': 23, '2020_08_20': 23, '2020_08_21': 23, '2020_08_22': 23, '2020_08_23': 23, '2020_08_24': 23, '2020_08_25': 23, '2020_08_26': 23, '2020_08_27': 23, '2020_08_28': 23, '2020_08_29': 23, '2020_08_30': 23, '2020_08_31': 23, '2020_09_01': 23, '2020_09_02': 23, '2020_09_03': 23, '2020_09_04': 23, '2020_09_05': 23, '2020_09_06': 23, '2020_09_07': 23, '2020_09_08': 23, '2020_09_09': 23, '2020_09_10': 23, '2020_09_11': 22, '2020_09_12': 22, '2020_09_13': 22, '2020_09_14': 22, '2020_09_15': 22, '2020_09_16': 22, '2020_09_17': 22, '2020_09_18': 22, '2020_09_19': 22, '2020_09_20': 22, '2020_09_21': 23, '2020_09_22': 23, '2020_09_23': 24, '2020_09_24': 24, '2020_09_25': 23, '2020_09_26': 23, '2020_09_27': 23, '2020_09_28': 23, '2020_09_29': 23, '2020_09_30': 23, '2020_10_01': 23, '2020_10_02': 22, '2020_10_03': 23, '2020_10_04': 22, '2020_10_05': 22, '2020_10_06': 22, '2020_10_07': 18, '2020_10_08': 18, '2020_10_09': 18, '2020_10_10': 18, '2020_10_11': 18, '2020_10_12': 18, '2020_10_13': 19, '2020_10_14': 18, '2020_10_15': 17, '2020_10_16': 16, '2020_10_17': 15, '2020_10_18': 15, '2020_10_19': 15, '2020_10_20': 15, '2020_10_21': 15, '2020_10_22': 15, '2020_10_23': 15, '2020_10_24': 16, '2020_10_25': 16, '2020_10_26': 16, '2020_10_27': 16, '2020_10_28': 15, '2020_10_29': 15, '2020_10_30': 14, '2020_10_31': 12, '2020_11_01': 12, '2020_11_02': 12, '2020_11_03': 11, '2020_11_04': 13, '2020_11_05': 11, '2020_11_06': 11, '2020_11_07': 11, '2020_11_08': 10, '2020_11_09': 10, '2020_11_10': 11, '2020_11_11': 10, '2020_11_12': 11, '2020_11_13': 10, '2020_11_14': 11, '2020_11_15': 10, '2020_11_16': 11, '2020_11_17': 11, '2020_11_18': 11, '2020_11_19': 10, '2020_11_20': 10, '2020_11_21': 11, '2020_11_22': 11, '2020_11_23': 11, '2020_11_24': 10, '2020_11_25': 11, '2020_11_26': 15, '2020_11_27': 15, '2020_11_28': 15, '2020_11_29': 15, '2020_11_30': 14, '2020_12_01': 14, '2020_12_02': 14, '2020_12_03': 14, '2020_12_04': 14, '2020_12_05': 14, '2020_12_06': 14, '2020_12_07': 14, '2020_12_08': 13, '2020_12_09': 13, '2020_12_10': 13, '2020_12_11': 13, '2020_12_12': 12, '2020_12_13': 12, '2020_12_14': 12, '2020_12_15': 12, '2020_12_16': 12, '2020_12_17': 12, '2020_12_18': 12, '2020_12_19': 12, '2020_12_20': 12, '2020_12_21': 12, '2020_12_22': 12, '2020_12_23': 12, '2020_12_24': 12, '2020_12_25': 12, '2020_12_26': 12, '2020_12_27': 12, '2020_12_28': 12, '2020_12_29': 12, '2020_12_30': 12, '2021_01_13': 15, '2021_01_14': 15, '2021_01_15': 15, '2021_01_16': 15, '2021_01_17': 15, '2021_01_18': 15, '2021_01_19': 15, '2021_01_20': 16, '2021_01_21': 16, '2021_01_22': 16, '2021_01_23': 16, '2021_01_24': 16, '2021_01_25': 16, '2021_01_26': 16, '2021_01_27': 16, '2021_01_28': 16, '2021_01_29': 16, '2021_01_30': 16, '2021_01_31': 16, '2021_02_01': 16, '2021_02_02': 16, '2021_02_03': 16, '2021_02_04': 16, '2021_02_05': 16, '2021_02_06': 16, '2021_02_07': 16, '2021_02_08': 16, '2021_02_09': 16, '2021_02_10': 16, '2021_02_11': 16, '2021_02_12': 16, '2021_02_13': 16, '2021_02_14': 16, '2021_02_15': 16, '2021_02_16': 16, '2021_02_17': 16, '2021_02_18': 16, '2021_02_19': 16, '2021_02_20': 16, '2021_02_21': 16, '2021_02_22': 16, '2021_02_23': 16, '2021_02_24': 16, '2021_02_25': 16, '2019_04_18': 11, '2019_06_14': 16, '2019_10_10': 10, '2019_10_11': 10, '2019_10_12': 9, '2019_10_13': 9, '2019_10_14': 9, '2019_10_15': 9, '2019_10_16': 9, '2019_10_17': 9, '2019_10_18': 9, '2019_10_19': 9, '2019_10_20': 9, '2019_10_21': 9, '2019_10_22': 9, '2019_10_23': 9, '2019_10_24': 17, '2019_10_25': 9, '2019_10_26': 19, '2019_10_27': 19, '2019_10_30': 19, '2019_10_31': 19, '2019_11_01': 19, '2019_11_02': 19, '2019_11_03': 19, '2019_11_04': 19, '2019_11_05': 19, '2019_11_06': 19, '2019_11_07': 19, '2019_11_08': 19, '2019_11_09': 9, '2019_11_10': 9, '2019_11_11': 9, '2019_11_12': 9, '2019_11_13': 10, '2019_11_14': 9, '2019_11_15': 9, '2019_11_16': 9, '2019_11_17': 9, '2019_11_18': 11, '2019_11_19': 12, '2019_11_20': 12, '2019_11_21': 12, '2019_11_22': 11, '2019_11_23': 11, '2019_11_24': 11, '2019_11_25': 11, '2019_11_26': 11, '2019_11_27': 11, '2019_11_28': 10, '2019_11_29': 10, '2019_11_30': 10, '2019_12_01': 10, '2019_12_02': 10, '2019_12_03': 10, '2019_12_04': 20, '2019_12_05': 10, '2019_07_25': 10, '2019_07_26': 10, '2019_07_27': 10, '2019_07_28': 10, '2019_07_29': 10, '2019_07_30': 10, '2019_07_31': 10, '2019_08_01': 10, '2019_08_02': 10, '2019_08_03': 10, '2019_08_04': 10, '2019_08_05': 10, '2019_08_06': 10, '2019_08_07': 10, '2019_08_08': 10, '2019_08_09': 10, '2019_08_10': 10, '2019_08_11': 10, '2019_08_12': 10, '2019_08_13': 10, '2019_08_14': 10, '2019_08_15': 10, '2019_08_16': 10, '2019_08_18': 10, '2019_08_19': 10, '2019_08_20': 10, '2019_08_21': 10, '2019_08_22': 10, '2019_08_23': 10, '2019_08_24': 10, '2019_08_25': 10, '2019_08_26': 10, '2019_08_29': 10, '2019_08_30': 10, '2019_08_31': 10, '2019_09_01': 10, '2019_09_02': 11, '2019_09_03': 13, '2019_09_04': 12, '2019_09_05': 16, '2019_09_06': 13, '2019_09_07': 13, '2019_09_08': 13, '2019_09_09': 13, '2019_09_10': 13, '2019_04_17': 20, '2019_05_07': 20, '2019_06_13': 5, '2021_01_06': 13, '2021_01_07': 15, '2021_01_08': 15, '2021_01_09': 15, '2021_01_10': 15, '2021_01_11': 15, '2021_01_12': 15, '2021_02_26': 13, '2021_02_27': 13, '2021_02_28': 13, '2021_03_01': 13, '2021_03_02': 13, '2021_03_03': 13, '2021_03_04': 13, '2021_03_05': 13, '2021_03_06': 13, '2021_03_07': 13, '2021_03_08': 13, '2021_03_09': 13, '2021_03_10': 13, '2021_03_11': 13, '2021_03_12': 13, '2021_03_13': 13, '2021_03_14': 13, '2021_03_15': 13, '2021_03_16': 13, '2021_03_17': 13, '2021_03_18': 13, '2021_03_19': 13, '2021_03_20': 13, '2021_03_21': 13, '2021_03_22': 13, '2021_03_23': 13, '2021_03_24': 13, '2021_03_25': 13, '2021_03_26': 13, '2021_03_27': 13, '2021_03_28': 13, '2021_03_29': 13, '2021_03_30': 13, '2021_03_31': 13, '2021_04_01': 13, '2021_04_02': 13, '2021_04_03': 13, '2021_04_04': 13, '2021_04_05': 13, '2021_04_06': 13, '2021_04_07': 13, '2021_04_08': 13, '2021_04_09': 13, '2021_04_10': 13, '2021_04_11': 13, '2021_04_12': 13, '2021_04_13': 13, '2021_04_14': 13, '2021_04_15': 13, '2021_04_16': 13, '2021_04_17': 13, '2021_04_18': 11, '2021_04_19': 11, '2021_04_20': 11, '2021_04_21': 11, '2021_04_22': 11, '2021_04_23': 11, '2021_04_24': 10, '2021_04_25': 10, '2021_04_26': 10, '2020_12_31': 11, '2021_01_01': 11, '2021_01_02': 11, '2021_01_03': 11, '2021_01_04': 11, '2021_01_05': 10, '2019_06_12': 3, '2019_06_20': 2, '2019_02_07': 6, '2019_02_08': 5, '2019_02_09': 5, '2019_02_10': 5, '2019_02_11': 5, '2019_02_12': 5, '2019_02_18': 5, '2019_02_22': 5, '2019_02_23': 5, '2019_02_24': 5, '2019_02_25': 5, '2019_02_26': 5, '2019_02_27': 5, '2019_03_14': 6, '2019_03_15': 6, '2019_03_16': 5, '2019_03_17': 5, '2019_03_18': 6, '2019_03_19': 5, '2019_03_20': 5, '2021_04_27': 9, '2021_04_28': 9, '2021_04_29': 9, '2021_04_30': 9, '2021_05_01': 7, '2021_05_02': 7, '2021_05_03': 7, '2021_05_04': 7, '2021_05_05': 7, '2021_05_06': 7, '2021_05_07': 7, '2021_05_08': 7, '2021_05_09': 7, '2021_05_17': 7, '2021_05_18': 7, '2021_05_19': 6, '2021_05_20': 6, '2021_05_21': 6, '2021_05_22': 6, '2021_05_23': 6, '2021_05_24': 6, '2021_05_25': 6, '2021_05_26': 6, '2021_05_27': 6, '2021_05_31': 6, '2021_06_01': 6, '2021_06_02': 6, '2021_06_03': 6, '2021_06_04': 6, '2021_06_05': 6, '2021_06_06': 6, '2021_06_07': 6, '2021_06_09': 6, '2021_06_10': 6, '2021_06_11': 6, '2021_06_12': 6, '2021_06_13': 6, '2021_06_14': 6, '2021_06_15': 6, '2021_06_16': 6, '2021_06_17': 6, '2021_06_18': 6, '2021_06_19': 6, '2021_06_20': 6, '2021_06_21': 6, '2021_06_22': 6, '2021_06_23': 6, '2021_06_24': 6, '2021_06_29': 6, '2021_06_30': 6, '2021_07_01': 6, '2021_07_05': 5, '2021_07_06': 5, '2021_07_07': 5, '2021_07_08': 6, '2021_07_09': 6, '2021_07_12': 6, '2021_07_13': 5, '2021_07_14': 5, '2021_07_15': 5, '2021_07_16': 5, '2021_07_17': 5, '2021_07_18': 5, '2021_07_19': 5, '2021_07_20': 5, '2021_07_21': 5, '2021_07_22': 5, '2021_07_23': 5, '2021_07_24': 5, '2021_07_25': 5, '2021_07_26': 5, '2021_07_27': 5, '2021_07_28': 5, '2021_07_29': 5, '2021_07_30': 5, '2021_07_31': 5, '2021_08_01': 5, '2021_08_02': 5, '2021_08_03': 4, '2021_08_04': 4, '2021_08_05': 4, '2021_08_06': 4, '2021_08_07': 4, '2021_08_08': 4, '2021_08_09': 4, '2021_08_10': 4, '2021_08_11': 4, '2021_08_12': 4, '2021_08_13': 4, '2021_08_14': 4, '2021_08_15': 4, '2021_08_16': 4, '2021_08_17': 4, '2021_08_18': 4, '2021_08_19': 4, '2021_08_20': 4, '2021_08_26': 4, '2021_08_27': 4, '2021_08_28': 4, '2021_08_29': 4, '2019_06_19': 2, '2021_05_10': 6, '2021_05_11': 6, '2021_05_12': 6, '2021_05_13': 6, '2021_05_28': 5, '2021_05_29': 5, '2021_05_30': 5, '2021_06_08': 5, '2021_08_30': 3, '2021_08_31': 3, '2021_09_01': 3, '2021_09_02': 3, '2021_09_03': 3, '2021_09_04': 3, '2021_09_05': 3, '2021_09_06': 3, '2021_09_07': 3, '2021_09_08': 3, '2021_09_09': 3, '2021_09_10': 3, '2021_09_11': 3, '2021_09_12': 3, '2021_09_13': 3, '2021_09_14': 3, '2021_09_15': 3, '2021_09_16': 3, '2021_09_17': 3, '2021_09_18': 3, '2021_09_19': 3, '2021_09_20': 3, '2021_09_21': 3, '2021_09_22': 3, '2021_09_23': 3, '2021_09_24': 3, '2021_09_25': 3, '2021_09_26': 3, '2021_09_27': 3, '2021_09_28': 3, '2021_09_29': 3, '2021_09_30': 3, '2021_10_01': 3, '2021_10_02': 1, '2021_10_03': 1, '2021_10_04': 1, '2021_10_05': 1, '2021_10_06': 1, '2018_11_27': 3, '2018_11_28': 3, '2018_11_29': 3, '2018_11_30': 3, '2018_12_01': 3, '2018_12_02': 3, '2018_12_03': 4, '2018_12_04': 4, '2018_12_05': 5, '2018_12_06': 4, '2018_12_07': 4, '2018_12_10': 5, '2018_12_11': 5, '2018_12_12': 5, '2018_12_13': 5, '2018_12_14': 5, '2018_12_15': 4, '2018_12_16': 4, '2018_12_17': 5, '2018_12_18': 5, '2018_12_19': 5, '2018_12_20': 5, '2018_12_21': 5, '2018_12_22': 4, '2018_12_23': 4, '2018_12_24': 4, '2018_12_25': 4, '2018_12_26': 4, '2018_12_27': 4, '2018_12_28': 4, '2018_12_29': 4, '2018_12_30': 4, '2018_12_31': 4, '2019_01_01': 4, '2019_01_02': 5, '2019_01_03': 5, '2019_01_04': 5, '2019_01_05': 5, '2019_01_06': 5, '2019_01_07': 5, '2019_01_08': 5, '2019_01_09': 5, '2019_01_10': 5, '2019_01_11': 5, '2019_01_12': 5, '2019_01_13': 5, '2019_01_14': 5, '2019_01_15': 5, '2019_01_16': 5, '2019_01_17': 5, '2019_01_18': 5, '2019_01_19': 4, '2019_01_20': 4, '2019_01_21': 4, '2019_01_22': 4, '2019_01_23': 4, '2019_01_24': 5, '2019_01_25': 5, '2019_02_04': 4, '2019_02_05': 5, '2019_02_06': 4, '2019_02_13': 4, '2019_02_14': 4, '2019_02_15': 4, '2019_02_16': 4, '2019_02_17': 4, '2019_02_19': 3, '2019_02_20': 3, '2019_02_21': 4, '2019_02_28': 4, '2019_03_01': 4, '2019_03_02': 4, '2019_03_03': 4, '2019_03_04': 4, '2019_03_05': 5, '2019_03_06': 5, '2019_03_07': 5, '2019_03_08': 5, '2019_03_09': 4, '2019_03_10': 4, '2019_03_11': 4, '2019_03_12': 4, '2019_03_13': 4, '2019_03_21': 4, '2019_03_22': 4, '2019_03_23': 4, '2019_03_24': 4, '2019_03_25': 5, '2019_03_26': 5, '2019_03_27': 4, '2019_03_28': 4, '2019_03_29': 4, '2019_03_30': 4, '2019_03_31': 4, '2019_04_01': 4, '2019_04_02': 4, '2019_04_03': 4, '2019_04_04': 5, '2019_04_05': 5, '2019_04_06': 3, '2019_04_07': 3, '2019_04_08': 4, '2019_04_09': 3, '2019_04_10': 4, '2019_04_11': 4, '2019_04_12': 5, '2019_04_13': 4, '2019_04_14': 4, '2019_04_20': 4, '2019_04_21': 4, '2019_04_22': 4, '2019_04_23': 5, '2019_04_24': 5, '2019_04_25': 4, '2019_04_26': 4, '2019_04_27': 4, '2019_04_28': 4, '2019_04_29': 4, '2019_04_30': 4, '2019_05_01': 4, '2019_05_02': 4, '2019_05_03': 4, '2019_05_04': 4, '2019_05_05': 4, '2019_05_08': 4, '2019_05_09': 4, '2019_05_10': 4, '2019_05_11': 4, '2019_05_12': 4, '2019_05_13': 5, '2019_06_11': 2, '2019_06_21': 1, '2019_06_22': 1, '2019_06_23': 1, '2019_06_24': 1, '2019_06_25': 1, '2019_06_26': 1, '2019_06_27': 1, '2019_06_28': 1, '2019_06_29': 1, '2019_06_30': 1, '2019_07_01': 2, '2019_07_02': 2, '2019_07_03': 1, '2019_07_04': 1, '2019_05_15': 4, '2018_12_08': 1, '2018_12_09': 1, '2019_01_26': 2, '2019_01_27': 2, '2019_01_28': 2, '2019_01_29': 2, '2019_01_30': 2, '2019_01_31': 3, '2019_02_01': 3, '2019_02_02': 2, '2019_02_03': 2, '2019_05_14': 2, '2019_05_16': 3, '2019_05_17': 3, '2019_05_18': 3, '2019_05_19': 3, '2019_05_20': 3, '2019_05_22': 2, '2018_11_21': 2, '2018_07_19': 1, '2018_07_20': 1, '2018_07_21': 1, '2018_07_22': 1, '2018_07_23': 1, '2018_07_24': 1, '2018_07_25': 1, '2018_07_26': 1, '2018_07_27': 1, '2018_07_28': 1, '2018_07_29': 1, '2018_07_30': 1, '2018_07_31': 1, '2018_08_01': 1, '2018_08_02': 1, '2018_08_03': 1, '2018_08_04': 1, '2018_08_05': 1, '2018_08_06': 1, '2018_08_07': 1, '2018_08_08': 1, '2018_08_09': 1, '2018_08_10': 1, '2018_08_11': 1, '2018_08_12': 1, '2018_08_13': 1, '2018_08_14': 1, '2018_08_15': 1, '2018_08_16': 1, '2018_08_17': 1, '2018_08_18': 1, '2018_08_19': 1, '2018_08_20': 1, '2018_08_21': 1, '2018_08_22': 1, '2018_08_23': 1, '2018_08_24': 1, '2018_08_25': 1, '2018_08_26': 1, '2018_08_27': 1, '2018_08_28': 1, '2018_08_30': 1, '2018_08_31': 1, '2018_09_06': 1, '2018_09_07': 1, '2018_09_10': 1, '2018_09_11': 1, '2018_09_12': 1, '2018_09_13': 1, '2018_09_14': 1, '2018_10_09': 1, '2018_10_10': 1, '2018_10_11': 1, '2018_10_12': 1, '2018_10_13': 1, '2018_10_14': 1, '2018_10_15': 1, '2018_10_16': 1, '2018_10_17': 1, '2018_10_18': 1, '2018_10_30': 1, '2018_10_31': 1, '2018_11_05': 1, '2018_11_06': 1, '2018_11_07': 1, '2018_11_08': 1, '2018_11_09': 1, '2018_11_10': 1, '2018_11_11': 1, '2018_11_12': 1, '2018_11_13': 1, '2018_11_14': 1, '2018_11_15': 1, '2018_11_16': 1, '2018_11_17': 1, '2018_11_18': 1, '2018_11_19': 1, '2018_11_20': 1, '2018_11_22': 1, '2018_11_23': 1, '2018_11_24': 1, '2018_11_25': 1, '2018_11_26': 1, '2019_05_23': 1}
    doc_count = len(documents)
    try:
        for doc_id, doc in enumerate(documents):
            if doc_id < 49:
                continue
            url = doc["url"]
            doc_size = doc["size_in_bytes"]
            print(f"Connect to {url} {doc_id + 1}/{doc_count}")
            start = time.time()
            remote_f = remfile.File(url)
            if hasattr(remote_f, "open"):
                remote_f = remote_f.open()
            with h5py.File(remote_f, 'r') as f:
                for year_month in f.keys():
                    for day in f[year_month]:
                        key = f"{year_month}_{day}"
                        day_occurrences[key] = 1 + day_occurrences.get(key, 0)
            print(f"Fetch in {round(time.time() - start, 2)} seconds (document is {round(doc_size / 1024 ** 2, 2)} MB)")
    finally:
        print(f"day_occurrences: {day_occurrences}")
    return day_occurrences


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("--api_url", default="https://entrepot.recherche.data.gouv.fr")
    parser.add_argument("--project_name", default="cense")
    args = parser.parse_args()
    search_url = f"{args.api_url}/api/search?q={args.project_name}&per_page=1000"
    print(f"search_url: {search_url}")
    documents = fetch_hdf5_files(search_url)
    day_occurrences = fetch_sensors_per_day(documents)

if __name__ == "__main__":
    main()

